name: Build & Upload iOS (Unity Personal)

on:
  workflow_dispatch:

jobs:
  # üß© Step 1: Âú® Ubuntu ÂïüÁî® License
  activate-license:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Activate Unity Personal License
        uses: webbertakken/unity-activate@v1
        with:
          unityVersion: 2022.3.62f2
          personalLicense: ${{ secrets.UNITY_LICENSE }}
    outputs:
      UNITY_LICENSE: ${{ steps.activate.outputs.unityLicense }}

  # üß© Step 2: macOS Âª∫Êßã iOS Â∞àÊ°à
  build-ios:
    runs-on: macos-latest
    needs: activate-license
    env:
      UNITY_VERSION: 2022.3.62f2
      PROJECT_PATH: .
      BUILD_PATH: build/iOS
      APP_NAME: "V's Êé•Èæç"
      BUNDLE_ID: com.highlight.solitaire
      APP_VERSION: 20251107

    steps:
      - uses: actions/checkout@v4

      - name: Build iOS Project
        uses: webbertakken/unity-builder@v2
        with:
          targetPlatform: iOS
          unityVersion: ${{ env.UNITY_VERSION }}
          projectPath: ${{ env.PROJECT_PATH }}
          buildName: ${{ env.APP_NAME }}
          version: ${{ env.APP_VERSION }}
          allowDirtyBuild: true

      - name: Upload Xcode Project
        uses: actions/upload-artifact@v4
        with:
          name: iOS-Build
          path: build/iOS
