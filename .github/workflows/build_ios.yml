name: Build iOS Unity (Manual Activation)

on:
  workflow_dispatch:

jobs:
  build-ios:
    runs-on: macos-latest
    env:
      UNITY_VERSION: 2022.3.62f2
      UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
      PROJECT_PATH: .
      BUILD_PATH: build/iOS
      APP_NAME: "V's æ¥é¾"
      BUNDLE_ID: com.highlight.solitaire
      APP_VERSION: 20251107

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # ğŸ§© å®‰è£ Unity Hub CLI + æŒ‡å®šç‰ˆæœ¬
      - name: Install Unity Editor
        run: |
          brew install --cask unity-hub
          mkdir -p ~/Unity
          unity-hub install --version $UNITY_VERSION --modules ios

      # ğŸ§© åŒ¯å‡º Licenseï¼ˆå•Ÿç”¨ Personal Licenseï¼‰
      - name: Activate Unity License
        run: |
          echo "$UNITY_LICENSE" | base64 --decode > UnityLicense.ulf
          /Applications/Unity/Hub/Editor/$UNITY_VERSION/Unity.app/Contents/MacOS/Unity \
            -batchmode -nographics -logFile \
            -manualLicenseFile UnityLicense.ulf || true

      # ğŸ§© ç”¨ Unity åŒ¯å‡º iOS å°ˆæ¡ˆ
      - name: Build iOS Project
        run: |
          /Applications/Unity/Hub/Editor/$UNITY_VERSION/Unity.app/Contents/MacOS/Unity \
            -quit -batchmode -nographics \
            -projectPath "$PROJECT_PATH" \
            -buildTarget iOS \
            -executeMethod BuildScript.BuildiOS \
            -logFile build.log || true

      # ğŸ§© ä¸Šå‚³è¼¸å‡ºï¼ˆå¯ä¸‹è¼‰ Xcode å°ˆæ¡ˆï¼‰
      - name: Upload iOS Build
        uses: actions/upload-artifact@v4
        with:
          name: iOS-Project
          path: build/iOS
